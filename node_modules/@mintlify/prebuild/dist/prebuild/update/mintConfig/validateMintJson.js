import { formatIssue, validateMintConfig } from '@mintlify/validation';
import Chalk from 'chalk';
export const validateMintJson = async (mintConfigContents) => {
    let configObj;
    try {
        configObj = JSON.parse(mintConfigContents);
    }
    catch (e) {
        if (typeof e === 'object' && e != null) {
            if ('name' in e && e.name === 'SyntaxError') {
                console.error(`ðŸš¨ ${Chalk.red('mint.json has invalid JSON. You are likely missing a comma or a bracket. You can paste your mint.json file into https://jsonlint.com/ to get a more specific error message.')}`);
            }
            else if ('message' in e) {
                console.error(`ðŸš¨ ${Chalk.red(e.message)}`);
            }
        }
        throw Error();
    }
    const validationResults = validateMintConfig(configObj);
    if (!validationResults.success) {
        console.error(Chalk.red('ðŸš¨ Invalid mint.json:'));
        validationResults.error.issues.forEach((issue) => console.error(Chalk.red(formatIssue(issue))));
        throw Error();
    }
    if (validationResults.warnings.length > 0) {
        if (validationResults.warnings.length > 0) {
            console.warn(Chalk.yellow('âš ï¸ Warnings found in mint.json:'));
            validationResults.warnings.forEach((issue) => console.warn(Chalk.yellow(formatIssue(issue))));
        }
    }
    return validationResults;
};
